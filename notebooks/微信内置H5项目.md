# 前言

工作需要，用h5写一个微信内置网页报名流程项目。上次写html还是上学时交作业，现在着实有些手忙脚乱了，现学现用、磕磕绊绊，项目总算告一段落，到了要总结一下的时候了。

# 工具以及框架

由于我只负责h5界面(~~让我负责java后台，我也做不来啊。我对好多语言都有兴趣，对java就是提不起兴趣，或许是因为大学学java学烦了。~~)，所以就用了[HBuilder](http://www.dcloud.io/)只码web界面，这个开发工具开发h5网页来说很便利，比如它有代码提醒、边改边看模式、手机端网页运行、运行到iPhone上等等功能，但也有不好用的地方，比如快捷键、搜索方式等。

还有开发微信内置web网页必不可少的工具：[微信web开发者工具](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784140&token=&lang=zh_CN)。很不幸的说开发到中期才发现这个工具，明明就在微信JS-SDK下面就是视而不见。

当然还有谷歌浏览器Google Chrome，浏览器来说，我之前是火狐党，开发这个项目才用了谷歌浏览器。谷歌的开发者工具挺好用的，有错误调试，样式修改，多种手机屏幕调试。还有[微信JS-SDK说明文档](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1421141115&token=&lang=zh_CN)火狐浏览器上目录点击无效，谷歌浏览器就可以调转到相应内容。还有一点，项目中用到了一个别人写好的`picker`控件，在火狐浏览器上打开一团糟，谷歌浏览器完美运行，幸运的是微信内置浏览器也运行无误。重点说明：我不是火狐黑，项目之外依旧继续用火狐。

开发微信用的东西肯定要用微信提供的开发样式库[WeUI](https://mp.weixin.qq.com/wiki?t=resource/res_main&id=mp1455784134&token=&lang=zh_CN)，毕竟风格相近直接拿来用就行，即便是不一样，改起来也方便很多。包括微信的JS-SDK的[demo示例代码](http://203.195.235.76/jssdk/)

还有号称最接近原生APP体验的高性能前端框架[MUI](http://dev.dcloud.net.cn/mui/)，项目中的picker就是用的这里的。

# 微信分享调用和地图功能

微信分享和地图调用都使用了微信提供的JS-SDK，公众平台有详细的说明文档。这里只记录一些调用步骤和遇到的问题。

微信分享不用单独去写，微信内置网页右上角会自动加入分享功能，默认分享出去的网页样式标题为页面标题，图片为网页中第一张图片，简介也是第一段文字。如果想自定义这些样式内容，就需要重写分享方法。

引入js文件，建议调用`https`的js地址，如果页面启用了`https`，使用`http`的js地址在iOS9中将无法调用sdk

```JavaScript
<script src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js" type="text/javascript"></script>
```
调用config方法，配置权限验证

```JavaScript
wx.config({
	debug: true,//开启调试模式，一直有alert出现。发布页面时改为false
	appId: 'wx1234567890032222',//微信公众号唯一标示。
	timestamp: timestamp,//时间戳
	nonceStr: nonceStr,//随机串
	signature: signature,//签名
	jsApiList: [
		'checkJsApi',//验证客户端版本是否支持sdk
		'onMenuShareTimeline',//分享朋友圈
		'onMenuShareAppMessage',//发送给朋友
		'openLocation',//地图
		'showOptionMenu'//开启右上角按钮内页面分享按钮
	]
});

wx.ready(function() {
	// 1 判断当前版本是否支持指定 JS 接口，支持批量判断
	wx.checkJsApi({
		jsApiList: ['getNetworkType', 'previewImage'],
		success: function(res) {
		}
	});
	// 地理位置
	document.querySelector('#openLocation').onclick = function() {
		wx.openLocation({
			latitude: 22.537180,//纬度
			longitude: 113.976250,//经度
			name: 'xxxx酒店',//位置名
			address: '地址说明',
			scale: 14,//地图缩放级别范围从1~28
			infoUrl: ''//在查看位置界面底部显示的超链接,可点击跳转
		});
	};

	// 2.1 监听“分享给朋友”，按钮点击、自定义分享内容及分享结果接口
	wx.onMenuShareAppMessage({
		title: '分享标题',
		desc: '分享简介',
		link: 'https://www.baidu.com',//分享地址
		imgUrl: 'http://oalg33nuc.bkt.clouddn.com/image/wechatshareimg.jpg',//分享图片的地址
	});

	// 2.2 监听“分享到朋友圈”按钮点击、自定义分享内容及分享结果接口
	wx.onMenuShareTimeline({
		title: '分享标题',
		desc: '分享简介',
		link: 'https://www.baidu.com',//分享地址
		imgUrl: 'http://oalg33nuc.bkt.clouddn.com/image/wechatshareimg.jpg',//分享图片的地址
	});
	
	wx.showOptionMenu();//显示微信右上角点开的分享按钮
});
```

这一块前端网页还是比较简单的，因为所需要的`签名signature`等参数都是后台算好给的。生成签名需要`jsapi_ticket`，要拿到`jsapi_ticket`需要`access_token`，获取`access_token`的步骤和在iOS中做微信分享是一样的，拿`appid`和`secret`等参数调用接口获取`access_token`。

分享按钮的显示问题，有时候要求只要指定页面分享出去，其他页面不能要分享，要隐藏掉分享按钮(发给朋友/分享到朋友圈/复制链接/收藏/邮件等等等)。

![显示按钮](https://github.com/mxdios/notebook/blob/master/notebooks/images/WechatIMG65.jpeg?raw=true)

![隐藏按钮](https://github.com/mxdios/notebook/blob/master/notebooks/images/WechatIMG66.jpeg?raw=true)

显示的页面需要在`wx.config`的`jsApiList:[]`里面添加`showOptionMenu`。并调用`wx.showOptionMenu();`显示方法。

隐藏的页面需要在`wx.config`的`jsApiList:[]`里面添加`hideOptionMenu`。并调用`wx.hideOptionMenu();`隐藏方法。


# PopPicker在软键盘弹出时不能完全隐藏

# iOS第三方输入法遮盖输入框

# 警示框的悬浮显示

# placeholder样式

# 阻止事件冒泡












